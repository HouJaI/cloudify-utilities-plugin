tosca_definitions_version: cloudify_dsl_1_3

description: >
  This Blueprint installs the nodecellar application on two existing hosts.

imports:
  - http://www.getcloudify.org/spec/cloudify/4.0/types.yaml
  - imports/mongo-blueprint.yaml
  - imports/nodejs-blueprint.yaml
  - imports/nodecellar-blueprint.yaml

inputs:

  example_host_key:
    type: string
    description: path to a private key that matches the example hosts.

  mongod_host_ip:
    type: string

  nodejs_host_ip:
    type: string

  example_agent_config:
    default:
      install_method: remote
      user: ubuntu
      key: { get_input: example_host_key }

node_templates:

  mongod_host:
    type: cloudify.nodes.Compute
    properties:
      ip: { get_input: mongod_host_ip }
      agent_config: { get_input: example_agent_config }

  nodejs_host:
    type: cloudify.nodes.Compute
    properties:
      ip: { get_input: nodejs_host_ip }
      agent_config: { get_input: example_agent_config }

outputs:
  endpoint:
    description: Web application endpoint
    value: { concat: [ 'http://', { get_attribute: [ nodejs_host, ip ] }, { get_property: [ nodecellar, port ] } ] }
