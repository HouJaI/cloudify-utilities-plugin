tosca_definitions_version: cloudify_dsl_1_3

description: >
  This blueprint (step-1-blueprint.yaml) sets runtime properties that will be used in step 2 blueprint.

imports:
  - http://www.getcloudify.org/spec/cloudify/4.0/types.yaml
  - https://raw.githubusercontent.com/cloudify-incubator/cloudify-utilities-plugin/21-NodeInstanceProxy/plugin.yaml

inputs:

  bp_dep_archive:
    default: https://github.com/EarthmanT/the-not-blueprint/archive/master.zip

node_templates:

  hello_world:
    type: cloudify.nodes.Root
    interfaces:
      cloudify.interfaces.lifecycle:
        start: script.sh
    relationships:
    - type: cloudify.relationships.contained_in
      target: dep_proxy

  dep_proxy:
    type: cloudify.nodes.NodeInstanceProxy.Compute
    properties:
      resource_config:
        blueprint:
          id: ni_dep
          blueprint_archive: { get_input: bp_dep_archive }
          main_file_name: aws-compute-blueprint.yaml
        deployment:
          id: ni_dep
          inputs:
            vpc_id: vpc-f63fda91
            subnet_id: subnet-d932d090
          outputs:
            key: ni_dep_output
        node_instance:
          node:
            id: host
    interfaces:
      cloudify.interfaces.lifecycle:
        start:
          implementation: cfy_util.cloudify_deployment_proxy.tasks.execute_start
          inputs:
            workflow_id: install
            timeout: 1200
