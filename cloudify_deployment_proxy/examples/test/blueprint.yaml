tosca_definitions_version: cloudify_dsl_1_3

description: >
  This blueprint (step-1-blueprint.yaml) sets runtime properties that will be used in step 2 blueprint.

imports:
  - http://www.getcloudify.org/spec/cloudify/4.0/types.yaml
  - https://raw.githubusercontent.com/cloudify-incubator/cloudify-utilities-plugin/v1.0.0/plugin.yaml

inputs:

  bp_dep_archive:
    default: https://github.com/EarthmanT/the-not-blueprint/archive/master.zip

node_templates:

  bp_dep:
    type: cloudify.nodes.BlueprintDeployment
    properties:
      resource_config:
        blueprint_archive: { get_input: bp_dep_archive }

  dep_proxy:
    type: cloudify.nodes.DeploymentProxy
    properties:
      resource_config:
        deployment_id: { get_attribute: [ bp_dep, deployment_id ] }
        outputs:
          key: bp_dep_output
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: cfy_util.cloudify_deployment_proxy.tasks.wait_for_deployment_ready
          inputs:
            state: 'terminated'
            timeout: 60
            deployment_id: { get_attribute: [ bp_dep, deployment_id ] }
    relationships:
      - type: cloudify.relationships.depends_on
        target: bp_dep
